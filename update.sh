#!/usr/bin/env bash
set -euo pipefail

# Only commit if there are changes
if ! git diff --quiet; then
kaomojis=(
  "ヽ(・∀・)ﾉ"
  "(≧▽≦)"
  "(✿◠‿◠)"
  "(｡◕‿◕｡)"
  "٩(◕‿◕｡)۶"
  "(•̀ᴗ•́)و ̑̑"
  "(＾▽＾)"
  "(*^_^*)"
  "(─‿─)"
  "(⌒‿⌒)"
  "¯\\_(ツ)_/¯"
  "^_^"
  ":D"
  ";)"
  "(ಠ_ಠ)"
  "(ʘ‿ʘ)"
  "(¬_¬)"
  "(☉_☉)"
  "(✧ω✧)"
  "(ﾉ◕ヮ◕)ﾉ*:･ﾟ✧"
  "ヽ(´▽\`)/"
  "(๑˃ᴗ˂)ﻭ"
  "(｡♥‿♥｡)"
  "(★^O^★)"
  "(ﾉ≧ڡ≦) てへぺろ"
  "(◕‿◕✿)"
  "(づ｡◕‿‿◕｡)づ"
  "٩(^‿^)۶"
  "(☞ﾟヮﾟ)☞"
  "(´∇ﾉ｀*)ノ"
  "(ಥ﹏ಥ)"
  "(✖╭╮✖)"
  "(＾◡＾)っ"
  "(¬‿¬)"
  "(¬▂¬)"
  "(＞﹏＜)"
  "(≖ᴗ≖✿)"
  "(✌ﾟ∀ﾟ)☞"
  "(｡•́‿•̀｡)"
  "(≧ω≦)"
  "(◕‿◕)"
  "(⌒ω⌒)"
  "( ͡° ͜ʖ ͡°)"
  "(ʘᆽʘ)"
  "(ಥ_ಥ)"
  "(ʕ•ᴥ•ʔ)"
  "(=^･^=)"
  "(ღ˘⌣˘ღ)"
  "(•‿•)"
  "(୨୧ ❛⃘ੌ ᵕ ❛⃘ੌ)*･"
  "(✪‿✪)"
  "(◔̯◔)"
  "(♥ω♥*)"
  "(´｡• ᵕ •｡\`)"
  "(＾ｖ＾)"
  "(＾∀＾)"
  "(＾ω＾)"
  "(＾－＾)"
  "(￣▽￣)"
  "(￣ε￣)"
  "(￣︶￣)"
  "(￣ー￣)"
  "(￣ω￣)"
  "(￣ᆺ￣)"
  "(︶︹︺)"
  "(┳◇┳)"
  "(´•︵•\`)"
  "(╥﹏╥)"
  "(Ｔ﹏Ｔ)"
  "(Ｔ▽Ｔ)"
  "(；＿；)"
  "(ಥДಥ)"
  "(´༎ຶ▂༎ຶ\`)"
  "(´・ω・｀)"
  "(╬ಠ益ಠ)"
  "(凸ಠ益ಠ⊂)"
  "(\`皿´)"
  "(≖︿≖｡)"
  "(•̀へ•́╬)"
  "(≧Д≦)"
  "(;｀O´)>"
  "(〃｀皿´)"
  "(；￣Д￣）"
  "(ꐦ°᷄д°᷅)"
  "(⊙﹏⊙)"
  "(⊙_◎)"
  "(°ロ°) !"
  "(ノ゜Д゜)ノ"
  "(ﾟoﾟ〃)"
  "(；ﾟдﾟ)"
  "(・o・)"
  "(O_O)"
  "(TдT)"
  "(இ﹏இ )"
  "(;ω;)"
  "(;ＴДＴ)"
  "(இωஇ)"
  "(ಥ‸ಥ)"
  "(´Д⊂)"
  "｡･ﾟﾟ*(>д<)*ﾟﾟ･｡"
  "(♡˙︶˙♡)"
  "(❣‿❣)"
  "(｡♡‿♡｡)"
  "(❤ ω ❤)"
  "(❣♡❣)"
  "(♡_♡)"
  "(✿♥‿♥✿)"
  "(✿❦‿❦✿)"
  "(ღ♥‿♥ღ)"
  "(୨୧⸝⸝> ̫ <⸝⸝୨୧)"
  "(❀◕ ‿ ◕❀)"
  "(⊂(◉‿◉)つ)"
  "(づ￣ ³￣)づ"
  "(つ◕౪◕)つ━☆ﾟ.*･｡ﾟ"
  "(つ◉益◉)つ"
  "(✷‿✷)"
  "(◕‿↼)"
  "(ʕ￫ᴥ￩ʔ)"
  "(｡･ω･｡)"
  "(●´ω｀●)"
  "(～￣▽￣)～"
  "(⌒▽⌒)"
  "(～‿～)"
  "(°╭╮°)"
  "(●´∀｀●)"
  "(⌒_⌒;)"
  "(･_･;)"
  "(･ิᴗ･ิ)"
  "( ´ ▽ \` )"
  "(º_º)"
  "(*≧ω≦)"
  "(*^^*)"
  "(*￣▽￣)"
  "(*≧▽≦)"
  "(*^▽^*)"
  "(*＞▽＜)"
  "(˶‾᷄ ⁻̫ ‾᷅˵)"
  "(*^‿^*)"
  "(+_+)"
  "(^_-)"
  "(^_~)"
  "(-_-)"
  "(-_-) zzZ"
  "(-_-;)"
  "(-.-)"
  "(>_<)"
  "(＞_＜)"
  "(≻ᨎ≺)"
  "(◔_◔)"
  "(◐‿◑)"
  "(◐﹏◑)"
  "(~˘▾˘)~"
  "(▰˘︹˘▰)"
  "(ʘдʘ╬)"
)
  count=${#kaomojis[@]}
  index=$(( RANDOM % count ))
  msg=${kaomojis[index]}
  git add .
  git commit -m "$msg"
else
  echo "No changes to commit."
fi

echo "Pushing to remote..."
git push
echo "Resuming after 5 seconds...."
sleep 5
echo "Done\n"
echo "Deploying on remote server..."
ssh nickesselman.nl 'bash -s' <<'ENDSSH'
set -euo pipefail
cd ~/escape-room/
echo "Pulling latest code..."
git pull

echo "Running npm run deploy..."
if ! ./deploy.sh; then
  echo "deploy.sh failed!" >&2
  exit 1
fi

echo "Deployment complete!"
ENDSSH

echo "All done!"